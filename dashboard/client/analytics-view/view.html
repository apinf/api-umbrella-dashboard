<template name="apiAnalyticsView">
  <div class="container-fluid">
    <h1 class="page-header">API Analytics View</h1>

    {{# unless fetchingData }}
      {{> spinner }}
    {{ else }}
      {{# if error }}
        <h1>ElasticSearch query error</h1>
        <p>{{ error }}</p>
      {{/ if }}
      {{# if elasticsearchData }}
        <div data-overview-id="{{ proxyBackendPath}}">
          <div class="row">
            <!-- number of requests chart -->
            <div class="col-xs-10 col-md-3">
              <span class="overview-col-title">
                {{ bucket.requestNumber }} API Requests
              </span>
              {{> requestsOverTime aggregations=bucket.requestOverTime attr=proxyBackendPath }}
              {{# with bucket }}
                <div class="{{ arrowDirection 'requests' }}"></div>
                <span>{{ summaryComparing 'requests' }}</span>
              {{/ with }}
            </div>
            <!-- response status list-->
            <div class="col-xs-2 col-md-3">
              {{# with bucket }}
                <p class="text-success">
                  2XX calls: {{ callsCount.success }}
                </p>
                <p class="text-info">
                  3XX calls: {{ callsCount.redirect }}
                </p>
                <p class="text-warning">
                  4XX calls: {{ callsCount.fail }}
                </p>
                <p class="text-danger">
                  5XX calls: {{ callsCount.error }}
                </p>
              {{/ with }}
            </div>
            <!-- response time chart -->
            <div class="col-xs-12 col-md-3">
              <span class="overview-col-title">
                {{ bucket.responseTime }} ms averageResponseTime
              </span>
              {{> averageResponseTime aggregations=bucket.requestOverTime attr=proxyBackendPath }}
              {{# with bucket }}
                <div class="{{ arrowDirection 'response' }}"></div>
                <span>{{ summaryComparing 'response' }}</span>
              {{/ with }}

            </div>
            <!-- unique users chart -->
            <div class="col-xs-12 col-md-3">
              <span class="overview-col-title">
                {{ bucket.uniqueUsers }} Unique API users
              </span>
              {{> uniqueUsersOverTime aggregations=bucket.requestOverTime attr=proxyBackendPath }}
              {{# with bucket }}
                <div class="{{ arrowDirection 'users' }}"></div>
                <span>{{ summaryComparing 'users' }}</span>
              {{/ with }}
            </div>
          </div>
          <div class="row">
            <!-- request timeline chart -->
            <div class="col-xs-12 col-md-6">
              {{> requestTimeline buckets=timelineData }}
            </div>
            <!-- response time timeline chart -->
            <div class="col-xs-12 col-md-6">
              {{> responseTimeTimeline buckets=timelineData }}
            </div>
          </div>
          <div class="row">
            <!-- table with list of problems -->
            <div class="col-xs-12 col-md-6">
              {{> problemsTable buckets=problemsData }}
            </div>
            <!-- most frequent users -->
            <div class="col-xs-12 col-md-6">
              {{> mostFrequentUsersTable buckets=mostFrequentUsers }}
            </div>
          </div>
        </div>
      {{/ if }}
    {{/ unless }}
  </div>
</template>
